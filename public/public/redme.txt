sr_live

Render の server.js（wss://<your-domain>/ws）へ接続する方式

ブラウザ ↔ Node（リレー）間での 自動再接続（指数バックオフ）実装

ブラウザ → Node への 定期 Ping（10秒）送信（接続維持）

Node → ブラウザの HB（heartbeat）メッセージ受信を無害化（サーバー側 heartbeatを想定）

過去コメントを /get_comment_log?room_id=... から取得（Node経由でCORS回避）し画面に表示＋バッファ登録

WebSocket のコメントをバッファ化し、APIからの過去コメントと差分補完（ID または 名前+コメント一致）して ★補完★ を表示

有料／無料ギフトの累積表示（既存ロジックを踏襲）

設定パネルでフォントサイズ・色を変えられる

そのまま public/ に置いて使える HTML（Node 側は既に /get_comment_log と /get_broadcast_key、および /ws を提供している想定）です。


server.js（最終完成版）
✔ Node22 + ESM
✔ Showroom WebSocket 自動再接続
✔ Heartbeat（PING）10 秒
✔ ブラウザ WS への Heartbeat
✔ 過去コメント API
✔ public/ 配信
✔ ブラウザから {broadcast_key} を受け取り接続